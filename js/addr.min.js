$(function(){function t(t){$.ajax({type:"get",async:!0,url:t,success:function(t){$("#s_lastestheight").html(t.height),$("#s_trans").html(t.transactions),$("#s_addrs").html(t.addresses),$("#block_trans").show()},error:function(t){console.log(t.statusText)}})}function e(t){$("#addrdetailTable").mask(),$.ajax({type:"get",async:!0,url:t,success:function(t){_=t.balance,$(".static_chart").mask(),$.ajax({type:"get",async:!0,url:x.url,success:function(t){n(t.items),$(".static_chart").unmask(),$("#listTableDiv2").hide()},error:function(t){console.error(t)}}),a(t),$("#addrdetailTable").unmask(),$("#listTableDiv").hide(),$(".moreshow").addClass("tt");var e=!0;$("#optionsRadios1").on("click",function(){e?($(".moreshow").removeClass("tt"),e=!1):($(".moreshow").addClass("tt"),e=!0)})},error:function(t){console.error(t)}}),$("#tokenlist").mask(),$.ajax({type:"get",async:!0,url:d.url,success:function(t){},error:function(t){console.error(t)}}),$("#addrtokentxslistTable").mask(),$.ajax({type:"get",async:!0,url:p.url,success:function(t){},error:function(t){console.error(t)}}),$("#addrtxslistTable").mask(),$.ajax({type:"get",async:!0,url:u.url,success:function(t){r(t),$("#addrtxslistTable").unmask(),$("#listTableDiv3").hide()},error:function(t){console.error(t)}})}function a(t){$("#addrStr").text(t.addrStr),$("#balance").text(t.balance+" SLU"),t.unconfirmedBalance>0?$("#unconfirmedBalance").text(t.unconfirmedBalance+" SLU"):$("#trunconfirmed").hide(),$("#totalReceived").text(t.totalReceived+" SLU"),$("#totalSent").text(t.totalSent+" SLU"),$("#txApperances").text(t.txApperances)}function r(t){$("#addrtxslistTable").bootstrapTable("destroy"),$("#addrtxslistTable").bootstrapTable({data:t.txs,pagination:!1,columns:[{title:$.i18n.prop("bt-txid"),field:"txid",align:"center",formatter:function(t,e,a){var r="<a href='/transaction/txid.html?txid="+t+"'>"+t+"</a>";return r}},{title:$.i18n.prop("bt-confirmations"),field:"confirmations",align:"center",sortable:!0},{title:$.i18n.prop("bt-vin_count"),field:"vin",align:"center",sortable:!0,formatter:function(t,e,a){return t.length}},{title:$.i18n.prop("bt-vout_count"),field:"vout",align:"center",sortable:!0,formatter:function(t,e,a){return t.length}},{title:$.i18n.prop("bt-time"),field:"time",align:"center",sortable:!0,formatter:function(t,e,a){return cnen_timeformater(t)}}]})}function n(t){function e(t,e){var a=Date.parse(t.key),r=Date.parse(e.key);return a-r}function a(){var t=d3.mouse(this)[0],e=d3.mouse(this)[1],a=Math.round((t-h.xx-g)/v.step());a=Math.max(0,a),a=Math.min(K.length-1,a);var r=K[a],n=R[a],s=Date.parse(r.key);s/=1e3,H.text($.i18n.prop("axis-date")+": "+cnen_timeformaterShort(s)).style("font-size",A+"px"),J.text($.i18n.prop("ad-FinalBalance")+": "+r.value.toFixed(3)+" SLU").style("font-size",A+"px"),N.text($.i18n.prop("svgTrans")+": "+n.value).style("font-size",A+"px"),t>.8*B&&e>.6*D?d3.select(".tips").attr("transform","translate("+(t-.23*B)+","+(e-.2*D)+")").style("display","block"):t>.8*B?d3.select(".tips").attr("transform","translate("+(t-.23*B)+","+e+")").style("display","block"):e>.6*D?d3.select(".tips").attr("transform","translate("+(t+.01*B)+","+(e-.2*D)+")").style("display","block"):d3.select(".tips").attr("transform","translate("+(t+.01*B)+","+(e+.01*D)+")").style("display","block")}if(t&&0!=t.length){var r=d3.timeFormat("%b %d"),n=d3.timeFormat("%m/%d/%Y");t=t.sort(function(t,e){return e.time0-t.time0});var s=d3.map(),l=(d3.map(),d3.map()),c=0,d=t.length,p=_;for(i=T;i>=z;i-=86400){var u=1e3*i,x=n(u);if(0==d)l.set(x,0),s.set(x,p);else{var f=1e3*t[c].time0,y=n(f);x!=y?(l.set(x,0),s.set(x,p)):(l.set(x,t[c].trans),s.set(x,t[c].balance),p=t[c].balance-t[c].balance_diff,c<d-1&&(c+=1))}}var h={xw:.935*B,xx:.04*B,xy:.75*D,yh:.6*D,yy:.15*D,y1x:.04*B,y2x:.975*B},m=S.append("g");m.append("rect").attr("x",h.xx+.32*B).attr("y",.045*D).attr("class","line3-text").attr("width",.02*B).attr("height",.001*B),m.append("circle").attr("cx",h.xx+.33*B).attr("cy",.045*D+5e-4*B).attr("r",.002*B).attr("class","line3-text"),m.append("text").attr("x",h.xx+.35*B).attr("y",.055*D).attr("class","legend").text($.i18n.prop("ad-FinalBalance")).style("font-family","sans-serif").style("font-size",.75*A+"px"),m.append("text").attr("x",h.xx+.52*B).attr("y",.055*D).attr("class","bar1-rect").text("■").style("font-size",.75*A+"px"),m.append("text").attr("x",h.xx+.535*B).attr("y",.055*D).attr("class","legend").text($.i18n.prop("svgTrans")).style("font-family","sans-serif").style("font-size",.75*A+"px");var b=l.keys().reverse(),v=d3.scaleBand().domain(b).range([0,h.xw]),g=v.bandwidth()/2;g=Math.min(10,g);var k=d3.axisBottom(v).tickFormat(function(t,e){var a=Date.parse(t);return r(a)});S.append("g").attr("class","axis tjbx").attr("transform","translate("+h.xx+","+h.xy+")").call(k).selectAll("text").attr("transform","rotate(-30)").style("text-anchor","end").style("font-size",.65*A+"px");var w=S.append("g").on("mousemove",a).on("mouseout",function(){d3.select(".tips").style("display","none")}),j=d3.max(l.values());0==j&&(j=1);var F=d3.scaleLinear().range([0,h.yh]).domain([1.2*j,0]),L=d3.axisRight(F).ticks(5).tickFormat(function(t){return o(t,4)});S.append("g").attr("class","axis tjby2").attr("transform","translate("+h.y2x+","+h.yy+")").call(L).selectAll("text").style("font-size",.65*A+"px"),S.append("text").attr("transform","translate("+(h.y2x+.025*B)+","+(h.yy-.03*D)+")").text($.i18n.prop("svgTrans")).style("font-family","sans-serif").style("font-size",.75*A+"px").attr("text-anchor","end");var R=l.entries();R=R.sort(e);w.selectAll(".barRect").data(R).enter().append("g").attr("class","barRect").append("rect").attr("class","bar1-rect").attr("width",g).attr("y",function(t){return h.yy+F(t.value)}).attr("x",function(t){return h.xx+v(t.key)+.5*v.bandwidth()-.5*g}).attr("height",function(t){return h.yh-F(t.value)});var M=d3.max(s.values()),U=d3.min(s.values()),C=U-.1*(M-U);C<0&&(C=0);var P=M+.1*(M-U),V=d3.scaleLinear().range([0,h.yh]).domain([P,C]),Y=[];Y.push(C);var E=(P-C)/5;Y.push(C+E),Y.push(C+2*E),Y.push(C+3*E),Y.push(C+4*E),Y.push(C+5*E);var G=d3.axisLeft(V).tickValues(Y).tickFormat(function(t){return o(t,4)});S.append("g").attr("class","axis tjby1").attr("transform","translate("+h.y1x+","+h.yy+")").call(G).selectAll("text").style("font-size",.65*A+"px"),S.append("text").attr("transform","translate("+(h.y1x-.035*B)+","+(h.yy-.03*D)+")").text($.i18n.prop("ad-FinalBalance")).style("font-family","sans-serif").style("font-size",.75*A+"px").attr("text-anchor","start");var I=d3.line().x(function(t){return h.y1x+v(t.key)+.5*v.bandwidth()}).y(function(t){return h.yy+V(t.value)}),K=s.entries();K=K.sort(e);w.append("g").append("path").attr("d",I(K)).attr("class","line3-rect").style("stroke-width",.001*B),w.selectAll("circle .tjby3-line").data(K).enter().append("circle").attr("class","tjby3-line").attr("cx",function(t){return h.y1x+v(t.key)+.5*v.bandwidth()}).attr("cy",function(t){return h.yy+V(t.value)}).attr("r",function(t){return.002*B}).attr("class","line3-text");var q=S.append("g").attr("class","tips").style("display","none");q.append("rect").attr("class","tips-border").attr("width",.22*B).attr("height",.14*D).attr("rx",10).attr("ry",10);var H=q.append("text").attr("class","tips-text blocktextblack").attr("x",A).attr("y",.04*D).text("").style("font-size",A+"px"),J=q.append("text").attr("class","tips-text blocktextblack").attr("x",A).attr("y",.08*D).text("").style("font-size",A+"px"),N=q.append("text").attr("class","tips-text blocktextblack").attr("x",A).attr("y",.12*D).text("").style("font-size",A+"px")}}function s(t){var e=new RegExp("^/address/(\\w{36})$");return!!e.test(t)}function l(t,e){var a=Math.pow(10,e),r=Math.round(t*a)/a,n=r.toString();return n}function o(t,e){return t>=1e6?l(t/1e6,e)+"M":t>=1e3?l(t/1e3,e)+"K":l(t,e)}var c,d,p,u,x,f=UrlParam.param("addr");if(void 0===f||36!=f.length){var y=GetUrlRelativePath();if(s(y)){var h=y.split("/");f=h[2]}else{var m=$.i18n.prop("Addressinvalid");top.location.href="/info.html?message="+encodeURIComponent(m)}}c=0==datasource?{url:"/jsondata/addr.json",newblock:"/jsondata/indexnew.json"}:{url:weburl+"/addr/"+f+"?noTxList=1",newblock:weburl+"/silkchain/indexnew"},d=0==datasource?{url:"/jsondata/addrtoken.json"}:{url:weburl+"/src20/balances?balanceAddress="+f},p=0==datasource?{url:"/jsondata/addrtokenTxs.json"}:{url:weburl+"/tokenTransfer?address="+f+"&limit=50"},u=0==datasource?{url:"/jsondata/addrVoutxrange.json"}:{url:weburl+"/txs/?address="+f};var b=new Date,v=b.format("m/d/Y"),g=v+" 00:00:01",k=new Date(g),w=v+" 23:59:59",j=new Date(w),T=k.getTime()/1e3,z=(j.getTime(),T-2592e3),_=0;x=0==datasource?{url:"/jsondata/addrtimesvalue2.json"}:{url:weburl+"/silkchain/addr/"+f+"/historynew"};var B=$(".static_chart").width(),D=Math.max(.3*B,150),S=d3.select(".static_chart").append("svg").attr("width",B).attr("height",.85*D),A=.01*B;t(c.newblock),e(c.url);A=.0102*B;$("#showhideBtn").bind("click",function(){var t=$("#showhideBtn").text();"显示"==t||"Show"==t?($("#showhideBtn").text($.i18n.prop("btn-hide")),$("#showhideDiv").show()):($("#showhideBtn").text($.i18n.prop("btn-show")),$("#showhideDiv").hide())})});