$(function(){function t(t){$.ajax({type:"get",async:!0,url:t,success:function(t){$("#s_lastestheight").html(t.height),$("#s_trans").html(t.transactions),$("#s_addrs").html(t.addresses),$("#block_trans").show()},error:function(t){console.log(t.statusText)}})}function e(t){$("#addrdetailTable").mask(),$.ajax({type:"get",async:!0,url:t,success:function(t){B=t.balance,$(".static_chart").mask(),$.ajax({type:"get",async:!0,url:u.url,success:function(t){n(t.items),$(".static_chart").unmask()},error:function(t){console.error(t)}}),a(t),$("#addrdetailTable").unmask(),$(".moreshow").addClass("tt");var e=!0;$("#optionsRadios1").on("click",function(){e?($(".moreshow").removeClass("tt"),e=!1):($(".moreshow").addClass("tt"),e=!0)})},error:function(t){console.error(t)}}),$("#tokenlist").mask(),$.ajax({type:"get",async:!0,url:d.url,success:function(t){},error:function(t){console.error(t)}}),$("#addrtokentxslistTable").mask(),$.ajax({type:"get",async:!0,url:p.url,success:function(t){},error:function(t){console.error(t)}}),$("#addrtxslistTable").mask(),$.ajax({type:"get",async:!0,url:x.url+"?limit=50&fromtime="+_,success:function(t){r(t),$("#addrtxslistTable").unmask()},error:function(t){console.error(t)}})}function a(t){$("#addrStr").text(t.addrStr),$("#balance").text(t.balance+" SLU"),t.unconfirmedBalance>0?$("#unconfirmedBalance").text(t.unconfirmedBalance+" SLU"):$("#trunconfirmed").hide(),$("#totalReceived").text(t.totalReceived+" SLU"),$("#totalSent").text(t.totalSent+" SLU"),$("#txApperances").text(t.txApperances)}function r(t){$("#addrtxslistTable").bootstrapTable("destroy"),$("#addrtxslistTable").bootstrapTable({data:t.items,pagination:!0,columns:[{title:$.i18n.prop("bt-txid"),field:"txid",align:"center",formatter:function(t,e,a){var r="<a href='/transaction/txid.html?txid="+t+"'>"+t+"</a>";return r}},{title:$.i18n.prop("bt-confirmations"),field:"confirmations",align:"center",sortable:!0},{title:$.i18n.prop("bt-vin_count"),field:"vins",align:"center",sortable:!0},{title:$.i18n.prop("bt-vout_count"),field:"vouts",align:"center",sortable:!0},{title:$.i18n.prop("bt-time"),field:"time",align:"center",sortable:!0,formatter:function(t,e,a){return cnen_timeformater(t)}}]})}function n(t){function e(t,e){var a=Date.parse(t.key),r=Date.parse(e.key);return a-r}function a(){var t=d3.mouse(this)[0],e=d3.mouse(this)[1],a=Math.round((t-h.xx-g)/v.step());a=Math.max(0,a),a=Math.min(K.length-1,a);var r=K[a],n=R[a],s=Date.parse(r.key);s/=1e3,q.text($.i18n.prop("axis-date")+": "+cnen_timeformaterShort(s)).style("font-size",F+"px"),H.text($.i18n.prop("ad-FinalBalance")+": "+r.value.toFixed(3)+" SLU").style("font-size",F+"px"),J.text($.i18n.prop("svgTrans")+": "+n.value).style("font-size",F+"px"),t>.8*S&&e>.6*A?d3.select(".tips").attr("transform","translate("+(t-.23*S)+","+(e-.2*A)+")").style("display","block"):t>.8*S?d3.select(".tips").attr("transform","translate("+(t-.23*S)+","+e+")").style("display","block"):e>.6*A?d3.select(".tips").attr("transform","translate("+(t+.01*S)+","+(e-.2*A)+")").style("display","block"):d3.select(".tips").attr("transform","translate("+(t+.01*S)+","+(e+.01*A)+")").style("display","block")}if(t&&0!=t.length){var r=d3.timeFormat("%b %d"),n=d3.timeFormat("%m/%d/%Y");t=t.sort(function(t,e){return e.time0-t.time0});var s=d3.map(),o=(d3.map(),d3.map()),c=0,d=t.length,p=B;for(i=T;i>=z;i-=86400){var x=1e3*i,u=n(x);if(0==d)o.set(u,0),s.set(u,p);else{var y=1e3*t[c].time0,f=n(y);u!=f?(o.set(u,0),s.set(u,p)):(o.set(u,t[c].trans),s.set(u,t[c].balance),p=t[c].balance-t[c].balance_diff,c<d-1&&(c+=1))}}var h={xw:.92*S,xx:.04*S,xy:.75*A,yh:.6*A,yy:.15*A,y1x:.04*S,y2x:.96*S},m=D.append("g");m.append("rect").attr("x",h.xx+.3*S).attr("y",.045*A).attr("class","line3-text").attr("width",.02*S).attr("height",.001*S),m.append("circle").attr("cx",h.xx+.31*S).attr("cy",.045*A+5e-4*S).attr("r",.002*S).attr("class","line3-text"),m.append("text").attr("x",h.xx+.33*S).attr("y",.055*A).attr("class","legend").text($.i18n.prop("ad-FinalBalance")).style("font-size",F+"px"),m.append("text").attr("x",h.xx+.5*S).attr("y",.055*A).attr("class","bar1-rect").text("■").style("font-size",F+"px"),m.append("text").attr("x",h.xx+.515*S).attr("y",.055*A).attr("class","legend").text($.i18n.prop("svgTrans")).style("font-size",F+"px");var b=o.keys().reverse(),v=d3.scaleBand().domain(b).range([0,h.xw]),g=v.bandwidth()/2;g=Math.min(10,g);var k=d3.axisBottom(v).tickFormat(function(t,e){var a=Date.parse(t);return r(a)});D.append("g").attr("class","axis tjbx").attr("transform","translate("+h.xx+","+h.xy+")").call(k).selectAll("text").attr("transform","rotate(-30)").style("text-anchor","end").style("font-size",.7*F+"px");var w=D.append("g").on("mousemove",a).on("mouseout",function(){d3.select(".tips").style("display","none")}),j=d3.max(o.values());0==j&&(j=1);var _=d3.scaleLinear().range([0,h.yh]).domain([1.2*j,0]),L=d3.axisRight(_).ticks(5).tickFormat(function(t){return l(t,4)});D.append("g").attr("class","axis tjby2").attr("transform","translate("+h.y2x+","+h.yy+")").call(L).selectAll("text").style("font-size",.7*F+"px"),D.append("text").attr("transform","translate("+(h.y2x+.02*S)+","+(h.yy-.03*A)+")").text($.i18n.prop("svgTrans")).style("font-size",F+"px").attr("text-anchor","end");var R=o.entries();R=R.sort(e);w.selectAll(".barRect").data(R).enter().append("g").attr("class","barRect").append("rect").attr("class","bar1-rect").attr("width",g).attr("y",function(t){return h.yy+_(t.value)}).attr("x",function(t){return h.xx+v(t.key)+.5*v.bandwidth()-.5*g}).attr("height",function(t){return h.yh-_(t.value)});var M=d3.max(s.values()),U=d3.min(s.values()),C=U-.1*(M-U);C<0&&(C=0);var P=M+.1*(M-U),V=d3.scaleLinear().range([0,h.yh]).domain([P,C]),Y=[];Y.push(C);var E=(P-C)/5;Y.push(C+E),Y.push(C+2*E),Y.push(C+3*E),Y.push(C+4*E),Y.push(C+5*E);var G=d3.axisLeft(V).tickValues(Y).tickFormat(function(t){return l(t,4)});D.append("g").attr("class","axis tjby1").attr("transform","translate("+h.y1x+","+h.yy+")").call(G).selectAll("text").style("font-size",.7*F+"px"),D.append("text").attr("transform","translate("+(h.y1x-.035*S)+","+(h.yy-.03*A)+")").text($.i18n.prop("ad-FinalBalance")).style("font-size",F+"px").attr("text-anchor","start");var I=d3.line().x(function(t){return h.y1x+v(t.key)+.5*v.bandwidth()}).y(function(t){return h.yy+V(t.value)}),K=s.entries();K=K.sort(e);w.append("g").append("path").attr("d",I(K)).attr("class","line3-rect").style("stroke-width",.001*S),w.selectAll("circle .tjby3-line").data(K).enter().append("circle").attr("class","tjby3-line").attr("cx",function(t){return h.y1x+v(t.key)+.5*v.bandwidth()}).attr("cy",function(t){return h.yy+V(t.value)}).attr("r",function(t){return.002*S}).attr("class","line3-text");var O=D.append("g").attr("class","tips").style("display","none");O.append("rect").attr("class","tips-border").attr("width",.22*S).attr("height",.14*A).attr("rx",10).attr("ry",10);var q=O.append("text").attr("class","tips-text blocktextblack").attr("x",F).attr("y",.04*A).text("").style("font-size",F+"px"),H=O.append("text").attr("class","tips-text blocktextblack").attr("x",F).attr("y",.08*A).text("").style("font-size",F+"px"),J=O.append("text").attr("class","tips-text blocktextblack").attr("x",F).attr("y",.12*A).text("").style("font-size",F+"px")}}function s(t){var e=new RegExp("^/address/(\\w{36})$");return!!e.test(t)}function o(t,e){var a=Math.pow(10,e),r=Math.round(t*a)/a,n=r.toString();return n}function l(t,e){return t>=1e6?o(t/1e6,e)+"M":t>=1e3?o(t/1e3,e)+"K":o(t,e)}var c,d,p,x,u,y=UrlParam.param("addr");if(void 0===y||36!=y.length){var f=GetUrlRelativePath();if(s(f)){var h=f.split("/");y=h[2]}else{var m=$.i18n.prop("Addressinvalid");top.location.href="/info.html?message="+encodeURIComponent(m)}}c=0==datasource?{url:"/jsondata/addr.json",newblock:"/jsondata/indexnew.json"}:{url:weburl+"/addr/"+y+"?noTxList=1",newblock:"/jsondata/indexnew.json"},d=0==datasource?{url:"/jsondata/addrtoken.json"}:{url:weburl+"/src20/balances?balanceAddress="+y},p=0==datasource?{url:"/jsondata/addrtokenTxs.json"}:{url:weburl+"/tokenTransfer?address="+y+"&limit=50"},x=0==datasource?{url:"/jsondata/addrVoutxrange.json"}:{url:weburl+"/silkchain/addr/"+y+"/voutxrange"};var b=new Date("2019-06-12"),v=b.format("m/d/Y"),g=v+" 00:00:01",k=new Date(g),w=v+" 23:59:59",j=new Date(w),T=k.getTime()/1e3,_=j.getTime()/1e3,z=T-2592e3,B=0;u=0==datasource?{url:"/jsondata/addrtimesvalue2.json"}:{url:weburl+"/silkchain/addr/"+y+"/historynew?from_date_time=1560355199"},testArray.addr.indexOf(y)>=0&&(u.url="/jsontest/addr/history/"+y+".json",x.url="/jsontest/addr/voutxrange/"+y+".json");var S=$(".static_chart").width(),A=Math.max(.3*S,150),D=d3.select(".static_chart").append("svg").attr("width",S).attr("height",.85*A),F=.01*S;t(c.newblock),e(c.url);F=.0102*S;$("#showhideBtn").bind("click",function(){var t=$("#showhideBtn").text();"显示"==t||"Show"==t?($("#showhideBtn").text($.i18n.prop("btn-hide")),$("#showhideDiv").show()):($("#showhideBtn").text($.i18n.prop("btn-show")),$("#showhideDiv").hide())})});