$(function(){function t(t){$.ajax({type:"get",async:!0,url:t,success:function(t){$("#s_lastestheight").html(t.height),$("#s_trans").html(t.transactions),$("#s_addrs").html(t.addresses),$("#block_trans").show()},error:function(t){console.log(t.statusText)}})}function e(t){$("#blockdetailTable").mask(),$("#coin_glyph").mask(),$("#coin_filter").mask(),$("#txlistTable").mask(),$.ajax({type:"get",async:!0,url:t,success:function(t){t.height>1e4&&t.txs.shift(),$(".moreshow").addClass("tt");var e=!0;$("#optionsRadios1").on("click",function(){e?($(".moreshow").removeClass("tt"),e=!1):($(".moreshow").addClass("tt"),e=!0)}),Y=t.max_txfee,Z=t.max_txsize,tt=t.max_vin_count,et=t.max_vout_count;var i=Math.max.apply(Math,t.txs.map(function(t){return t.vin_count})),l=Math.min.apply(Math,t.txs.map(function(t){return t.vin_count})),c=Math.max.apply(Math,t.txs.map(function(t){return t.vout_count})),d=Math.min.apply(Math,t.txs.map(function(t){return t.vout_count}));Q=Math.max(i,c),Math.min(l,d);Math.max(tt,et);at=d3.scaleLinear().domain([0,1.5*Q]).range([0,Math.PI]),nt=d3.scaleLinear().domain([0,Y]).range([.5,1]),a(t),n(t),$("#blockdetailTable").unmask(),o(t),$("#coin_filter").unmask(),s(t.txs),$("#coin_glyph").unmask(),r(t.txs),$("#txlistTable").unmask(),I=t},error:function(t){console.error(t.statusText)}})}function a(t){$("#block").text(t.height),$("#blockheight").text(t.height),$("#previousblockhash").attr("href","/block/blockhash.html?hash="+t.previousblockhash),$("#nextblockhash").attr("href","/block/blockhash.html?hash="+t.nextblockhash),$("#blockhash").text(t.hash),$("#blocktime").text(cnen_timeformater(t.time)),$("#blockminedby").text(t.miner),$("#blockreward").text(t.reward+" SLU"),$("#blocktxsfee").text(t.txfee_sum+" SLU"),$("#blocksize").text(t.size+" bytes"),$("#blockversion").text(parseInt(t.version).toString(16)),$("#blockconfirmations").text(t.confirmations)}function n(t){L.append("g").append("rect").attr("class","barbgclass").attr("width",.8*left_svg_w).attr("height",.8*left_svg_h).attr("transform","translate(0,0)").attr("fill-opacity",.2);L.append("text").attr("text-anchor","middle").attr("x","50%").attr("y",2*b.left).style("font-size",M).attr("class","blocktext2").text($.i18n.prop("current_trans")),V=L.append("text").attr("text-anchor","middle").attr("x","50%").attr("y",4*b.left).style("font-size",1.7*M).attr("class","blocktext1").text("")}function r(t){$("#txlistTable").bootstrapTable("destroy"),$("#txlistTable").bootstrapTable({data:t,pagination:!0,sortable:!0,columns:[{field:"txid",title:$.i18n.prop("bt-txid"),align:"center",formatter:function(t,e,a){var n="<a href='/transaction/txid.html?txid="+t+"'>"+t+"</a>";return n}},{field:"vin_count",title:$.i18n.prop("bt-vin_count"),align:"center",sortable:!0},{field:"vout_count",title:$.i18n.prop("bt-vout_count"),align:"center",sortable:!0},{field:"size",title:$.i18n.prop("bt-size"),align:"center",sortable:!0},{field:"txfee",title:$.i18n.prop("bt-txfee"),align:"center",sortable:!0}],onSort:function(e,a){$("#coin_filter").mask(),s(t,e,a),$("#coin_filter").unmask()}})}function s(t,e,a){V.text(t.length);var n=t;e&&(n="asc"==a?t.sort(function(t,a){return t[e]-a[e]}):t.sort(function(t,a){return a[e]-t[e]}));var r=R;d3.select(".mainClass").remove();var s=T.append("g").attr("class","mainClass").attr("id","mainsvg"),l=.65*r,o=.5*l,c=d3.scaleLinear().range([.2*.8*o,.8*.8*o]).domain([0,Z]),d=t.length,x={outerRadius:o,innerRadius:.8*o,x:0,y:.5*left_svg_h*.8},p=A,h=p/l,u=1,f=0,g=0,m=0;d>h?(u=2,f=Math.floor(h-4),g=(p-(f+1.7)*l)/f):(u=1,f=d,g=p/f,g>o&&(g=o,m=(p-(f*l+(f+1)*o))/2));for(let t=0;t<f;t++)x.x=m+t*(l+g)+2*o,i(s,x,Z,n[t],t,c);if(2==u)for(var v=0;v<6;v++)s.append("g").append("circle").attr("class","coin_circle").attr("cx",function(t){return m+f*(l+g)+1.1*o+v*l/7}).attr("cy",function(t){return x.y}).attr("r",1).attr("fill","grey");var y=s.append("g").attr("class","tips").attr("id","tipsbox").style("display","none");y.append("rect").attr("class","tips-border").attr("width",178).attr("height",66).attr("rx",10).attr("ry",10),y.append("text").attr("id","tipstext1").attr("class","tips-text blocktextblack").attr("x",10).attr("y",10).text("").style("font-size",M),y.append("text").attr("id","tipstext2").attr("class","tips-text blocktextblack").attr("x",10).attr("y",22).text("").style("font-size",M),y.append("text").attr("id","tipstext3").attr("class","tips-text blocktextblack").attr("x",10).attr("y",36).text("").style("font-size",M),y.append("text").attr("id","tipstext4").attr("class","tips-text blocktextblack").attr("x",10).attr("y",50).text("").style("font-size",M),y.append("text").attr("id","tipstext5").attr("class","tips-text blocktextblack").attr("x",10).attr("y",62).text("").style("font-size",M)}function i(t,e,a,n,r,s){e.x,e.y;var i=[];i.push(n);var o=t.append("g").selectAll("ring"+r).data(i).enter().append("g").attr("class","ring"+r);o.attr("id","coin"+r).attr("transform","translate("+e.x+","+e.y+")").on("mouseover",l).on("mouseout",function(){d3.select("#tipsbox").style("display","none")}).on("click",function(){top.location.href="/transaction/txid.html?"+$.param({txid:n.txid,addrsScale_max:Q})});var c=d3.arc().startAngle(0).endAngle(2*Math.PI).innerRadius(e.innerRadius).outerRadius(e.outerRadius);o.append("path").attr("d",c).style("fill","white").style("stroke","#ae7c4b").attr("stroke-width","1px");var d=o.append("g").attr("class","ring_2");d.append("circle").attr("r",e.innerRadius).style("fill","#e9c598").attr("opacity",function(t,e){return nt(n.txfee)}),d.append("text").attr("text-anchor","middle").attr("class","blocktext1").attr("x",-.5*e.innerRadius).attr("y",.25*e.innerRadius).text("T").style("font-size",M).attr("opacity",.5),d.append("text").attr("text-anchor","middle").attr("class","blocktext1").attr("x",.5*e.innerRadius).attr("y",.25*e.innerRadius).text("X").style("font-size",M).attr("opacity",.5);var x=10*n.size/a;x=Math.ceil(x),x<1&&(x=1);var p=d3.arc().startAngle(-.5*Math.PI+at(n.vin_count/2)).endAngle(function(){return-at(n.vin_count/2)-.5*Math.PI}).innerRadius(e.innerRadius+.6).outerRadius(e.outerRadius-.3),h=d3.arc().startAngle(.5*Math.PI-at(n.vout_count/2)).endAngle(function(){return at(n.vout_count/2)+.5*Math.PI}).innerRadius(e.innerRadius+.6).outerRadius(e.outerRadius-.3);o.append("path").attr("d",p).style("fill","#b2d9ed"),o.append("path").attr("d",h).style("fill","#b2d9ed"),d.append("rect").attr("x",-.5).attr("y",-e.innerRadius).attr("height",2*e.innerRadius).attr("width",1).style("fill","#ae7c4b").style("opacity","0.3");var u=d.append("g").attr("class","rect");u.append("rect").attr("x",function(t,e){return-.5*s(n.size)}).attr("y",function(t,e){return-.5*s(n.size)}).attr("width",function(t,e){return s(n.size)}).attr("height",function(t,e){return s(n.size)}).attr("fill","white").style("stroke","#ae7c4b").style("stroke-width",.8)}function l(t){function e(t){return t.replace(/(^\s*)|(\s*$)/g,"")}var a=$(this).css("transform").split("(")[1].split(")")[0].split(",")[4],n=$(this).css("transform").split("(")[1].split(")")[0].split(",")[5];try{d3.select("#tipstext1").text($.i18n.prop("bt-txid")+": "+e(t.txid).substring(0,5)+"..."+e(t.txid).substring(59,64)),d3.select("#tipstext2").text($.i18n.prop("bt-vin_count")+": "+t.vin_count),d3.select("#tipstext3").text($.i18n.prop("bt-vout_count")+": "+t.vout_count),d3.select("#tipstext4").text($.i18n.prop("bt-txfee")+": "+t.txfee+" SLU"),d3.select("#tipstext5").text($.i18n.prop("bt-size")+": "+t.size+" bytes"),d3.select("#tipsbox").attr("transform","translate("+a+","+(n-30)+")").style("display","block")}catch(t){console.log(t)}}function o(t){rt={x:2*b.left,y:.4*_-b.top,w:.28*k},st={h:.4*_-2*b.top-b.bottom,x:2*b.left,y:2*b.top},c(t.txs),x(t.txs),p(t.txs)}function c(t){function e(t){d3.mouse(this)[0],d3.mouse(this)[1];n.append("g").attr("id","rectbar").append("text").text($(this).attr("value")).attr("x",$(this).attr("x")).attr("y",$(this).attr("y")-2).style("font-size",1.2*M).style("display","inline-block")}function a(){try{if(!d3.event.selection)return void(s&&(s=!1,d()));s=!0;var t=d3.event.selection;if(t){var e=[],a=Math.min(t[0],t[1])-rt.x,n=Math.max(t[0],t[1])-rt.x;it.forEach(t=>{var r=t.x0;P(r)>=a&&P(r)<=n&&e.push(t)}),e.length>0?(ct=[],e.forEach(t=>{ct=ct.concat(t)})):ct=[]}}catch(t){ct=[]}ct.length>0?(dt=[],x(ct),xt=[],p(ct)):d(),h()}d3.select(".filterClass1").remove();var n=C.append("g").attr("class","filterClass1").attr("id","filtersvg");F=d3.max(t,function(t){return t.vin_count+t.vout_count}),P=d3.scaleLinear().domain([0,F+1]).range([0,rt.w]);var r=d3.axisBottom(P).ticks(5);K=d3.histogram().domain(P.domain()).thresholds(P.ticks(25)).value(function(t){return t.vin_count+t.vout_count}),it=K(t).filter(t=>t.length>0),n.append("g").attr("class","axis xAxis").attr("transform","translate("+rt.x+","+rt.y+")").call(r).selectAll("text").style("font-size",.7*M+"px"),n.append("text").attr("text-anchor","end").attr("transform","translate("+(rt.w+rt.x)+","+(rt.y+2.4*b.top)+")rotate(0)").text($.i18n.prop("axis-x1")).style("font-size",M+"px"),W=d3.max(it,function(t){return t.length}),U=d3.scaleLinear().domain([W,0]).range([0,st.h]);var s,i=d3.axisLeft(U).ticks(3);n.append("g").attr("class","axis xAxis").attr("transform","translate("+st.x+","+st.y+")").call(i).style("font-size",.7*M+"px"),n.append("text").attr("transform","translate("+(st.x-20)+","+(st.y-10)+")rotate(0)").text($.i18n.prop("axis-txs")).style("font-size",M+"px");n.append("g").data(it).attr("class","brush").call(d3.brushX().on("end",a));n.append("g").selectAll("rect").data(it).enter().append("rect").attr("x",t=>P(t.x0)+st.x-rt.w/80).attr("width",rt.w/40).attr("y",t=>U(t.length)+st.y).attr("height",t=>U(0)-U(t.length)).attr("fill","#d6b58e").attr("value",t=>t.length).attr("title",t=>t.length).on("mouseover",e).on("mouseout",function(){$("#rectbar").remove()})}function d(){ct=[],dt=[],xt=[],h(),c(I.txs),x(I.txs),p(I.txs)}function x(t){function e(t){n.append("g").attr("id","rectbar2").append("text").text($(this).attr("value")).attr("x",$(this).attr("x")).attr("y",$(this).attr("y")-2).style("font-size",1.2*M).style("display","block")}function a(){try{if(!d3.event.selection)return void(i&&(i=!1,d()));i=!0;var t=d3.event.selection;if(t){var e=[],a=Math.min(t[0],t[1])-rt.x,n=Math.max(t[0],t[1])-rt.x;lt.forEach(t=>{var r=t.x0;S(r)>=a&&S(r)<=n&&e.push(t)}),e.length>0?(dt=[],e.forEach(t=>{dt=dt.concat(t)})):dt=[]}}catch(t){dt=[]}dt.length>0?(ct=[],c(dt),xt=[],p(dt)):d(),h()}d3.select(".filterClass2").remove();var n=j.append("g").attr("class","filterClass2").attr("id","filtersvg2");H=d3.max(t,function(t){return t.txfee});var r=d3.min(t,function(t){return t.txfee});S=d3.scaleLinear().domain([r-H/5,H+H/5]).range([0,rt.w]);var s=d3.axisBottom(S).ticks(5).tickFormat(t=>t.toFixed(3));N=d3.histogram().domain(S.domain()).thresholds(S.ticks(25)).value(function(t){return t.txfee}),lt=N(t).filter(t=>t.length>0),n.append("g").attr("class","axis xAxis").attr("transform","translate("+rt.x+","+rt.y+")").call(s).selectAll("text").style("font-size",.7*M+"px"),n.append("text").attr("text-anchor","end").attr("transform","translate("+(rt.w+1.12*rt.x)+","+(rt.y+2.4*b.top)+")rotate(0)").text($.i18n.prop("axis-x3")).style("font-size",M+"px"),q=d3.max(lt,function(t){return t.length}),X=d3.scaleLinear().domain([q,0]).range([0,st.h]);var i,l=d3.axisLeft(X).ticks(3);n.append("g").attr("class","axis xAxis").attr("transform","translate("+st.x+","+st.y+")").call(l).style("font-size",.7*M+"px"),n.append("text").attr("transform","translate("+(st.x-23)+","+(st.y-10)+")rotate(0)").text($.i18n.prop("axis-txs")).style("font-size",M+"px");n.append("g").data(lt).attr("class","brush").call(d3.brushX().on("end",a));n.append("g").attr("fill","#d6b58e").selectAll("rect").data(lt).join("rect").attr("x",t=>S(t.x0)+st.x-rt.w/80).attr("width",rt.w/40).attr("y",t=>X(t.length)+st.y).attr("height",t=>X(0)-X(t.length)).text(t=>t.length).attr("value",t=>t.length).on("mouseover",e).on("mouseout",function(){$("#rectbar2").remove()})}function p(t){function e(t){n.append("g").attr("id","rectbar3").append("text").text($(this).attr("value")).attr("x",$(this).attr("x")).attr("y",$(this).attr("y")-2).style("font-size",1.2*M).style("display","block")}function a(){try{if(!d3.event.selection)return void(s&&(s=!1,d()));s=!0;var t=d3.event.selection;if(t){var e=[],a=Math.min(t[0],t[1])-rt.x,n=Math.max(t[0],t[1])-rt.x;ot.forEach(t=>{var r=t.x0;E(r)>=a&&E(r)<=n&&e.push(t)}),e.length>0?(xt=[],e.forEach(t=>{xt=xt.concat(t)})):xt=[]}}catch(t){xt=[]}xt.length>0?(dt=[],x(xt),ct=[],c(xt)):d(),h()}d3.select(".filterClass3").remove();var n=B.append("g").attr("class","filterClass3").attr("id","filtersvg3");G=d3.max(t,function(t){return t.size}),E=d3.scaleLinear().domain([rt.w/40*.5,G+100]).range([0,rt.w]);var r=d3.axisBottom(E).ticks(5);O=d3.histogram().domain(E.domain()).thresholds(E.ticks(25)).value(function(t){return t.size}),ot=O(t).filter(t=>t.length>0),n.append("g").attr("class","axis xAxis").attr("transform","translate("+rt.x+","+rt.y+")").call(r).selectAll("text").style("font-size",.7*M+"px"),n.append("text").attr("text-anchor","end").attr("transform","translate("+(rt.w+1.12*rt.x)+","+(rt.y+2.4*b.top)+")rotate(0)").text($.i18n.prop("axis-x2")).style("font-size",M+"px"),J=d3.max(ot,function(t){return t.length}),D=d3.scaleLinear().domain([J,0]).range([0,st.h]);var s,i=d3.axisLeft(D).ticks(3);n.append("g").attr("class","axis xAxis").attr("transform","translate("+st.x+","+st.y+")").call(i).style("font-size",.7*M+"px"),n.append("text").attr("transform","translate("+(st.x-20)+","+(st.y-10)+")rotate(0)").text($.i18n.prop("axis-txs")).style("font-size",M+"px");n.append("g").data(ot).attr("class","brush").call(d3.brushX().on("end",a));n.append("g").attr("fill","#d6b58e").selectAll("rect").data(ot).join("rect").attr("x",t=>E(t.x0)+st.x-rt.w/80).attr("width",rt.w/40).attr("y",t=>D(t.length)+st.y).attr("height",t=>D(0)-D(t.length)).text(t=>t.length).attr("value",t=>t.length).on("mouseover",e).on("mouseout",function(){$("#rectbar3").remove()})}function h(){var t=u();$("#coin_glyph").mask(),$("#txlistTable").mask(),r(t),s(t),$("#coin_glyph").unmask(),$("#txlistTable").unmask()}function u(){var t=ct.length,e=dt.length,a=xt.length;return t>0?ct:e>0?dt:a>0?xt:I.txs}var f,g=UrlParam.param("hash");if(void 0===g||64!=g.length){var m=GetUrlRelativePath();if(checkHash(m)){var v=m.split("/");g=v[2]}else{var y=$.i18n.prop("BlockHashinvalid");top.location.href="/info.html?message="+encodeURIComponent(y)}}f=0==datasource?{url:"/jsondata/blockhash.json",newblock:"/jsondata/indexnew.json"}:{url:weburl+"/silkchain/block/"+g,newblock:weburl+"/silkchain/indexnew"},centw=window.innerWidth;var b={top:.01*centw,right:.01*centw,bottom:.01*centw,left:.01*centw},k=$("#coin_glyph").width(),_=.2*k<100?100:.2*k,w=(k-b.left-b.right)/7.5,z=1.2974*w;left_svg_w=.38*w*2,left_svg_h=.24*z*.88*2;var M=.01*k,R=($("#coin_radio").height(),left_svg_h),A=k-.8*left_svg_w,L=d3.select("#coin_glyph").append("svg").attr("width",.8*left_svg_w).attr("height",left_svg_h).attr("transform","translate("+.6*b.left+",10)").attr("class","mainsvg_block"),T=d3.select("#coin_glyph").append("svg").attr("width",A-10).attr("height",left_svg_h).attr("transform","translate(10,10)"),C=d3.select("#coin_filter").append("svg").attr("width",.32*k).attr("height",.5*_).attr("transform","translate(0,"+b.left+")"),j=d3.select("#coin_filter").append("svg").attr("width",.32*k).attr("height",.5*_).attr("transform","translate("+.37*k+","+b.left+")"),B=d3.select("#coin_filter").append("svg").attr("width",.32*k).attr("height",.5*_).attr("transform","translate("+.296*-k+","+b.left+")");t(f.newblock),e(f.url);var I,P,S,E,U,X,D,F,H,G,W,q,J,K,N,O,Q,V,Y,Z,tt,et,at,nt,rt={},st={},it=[],lt=[],ot=[],ct=[],dt=[],xt=[];$("#showhideBtn").bind("click",function(){var t=$("#showhideBtn").text();"显示"==t||"Show"==t?($("#showhideBtn").text($.i18n.prop("btn-hide")),$("#showhideDiv").show()):($("#showhideBtn").text($.i18n.prop("btn-show")),$("#showhideDiv").hide())})});